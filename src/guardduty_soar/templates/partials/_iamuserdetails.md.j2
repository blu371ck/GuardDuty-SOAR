{# First, specifically check if the finding is for the Root user #}
{% if resource.user_name == 'root' %}
    - **Principal Type:** `Root`
    - **Account ID:** `{{ resource.principal_id }}`

{% elif enriched_data and enriched_data.details is mapping %}
    - **User Name:** `{{ enriched_data.details.UserName }}`
    - **User ID:** `{{ enriched_data.details.UserId }}`
    - **ARN:** `{{ enriched_data.details.Arn }}`
    - **Created:** `{{ enriched_data.details.CreateDate }}`

    {% if enriched_data.attached_policies %}
    
**Attached Policies:**
    {% for policy in enriched_data.attached_policies %}
    - {{ policy.PolicyName }} ({{ policy.PolicyArn }})
    {% endfor %}
    {% endif %}

    {% if enriched_data.inline_policies %}
    
**Inline Policies:**
    {% for name, doc in enriched_data.inline_policies.items() %}
    - {{ name }}
    {% endfor %}
    {% endif %}

    {% if enriched_data.permission_analysis and enriched_data.permission_analysis.risks_found %}
    
### ðŸš¨ Policy Analysis
    The following risks were identified in the principal's IAM policies:
    {% for policy_name, risks in enriched_data.permission_analysis.risks_found.items() %}
    - **{{ policy_name }}**:
      {% for risk in risks %}
      - `{{ risk | safe }}`
      {% endfor %}
    {% endfor %}
    {% endif %}

    {% if enriched_data.cloudtrail_history %}
    
### ðŸ“œ Recent CloudTrail Events
    A summary of the most recent API calls made by this principal:
    {% for event in enriched_data.cloudtrail_history %}
    - **{{ event.EventTime }}** | `{{ event.EventName }}` (Source: {{ event.EventSource }})
    {% endfor %}
    {% endif %}

{% else %}
    - _Detailed user information was not available for this finding._
{% endif %}