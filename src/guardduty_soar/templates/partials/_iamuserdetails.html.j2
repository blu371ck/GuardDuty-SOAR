{% if resource.user_name == 'root' %}
    <ul>
        <li><strong>Principal Type:</strong> <code>Root</code></li>
        <li><strong>Account ID:</strong> <code>{{ resource.principal_id }}</code></li>
    </ul>
{% elif enriched_data and enriched_data.details is mapping %}
    <ul>
        <li><strong>User Name:</strong> <code>{{ enriched_data.details.UserName }}</code></li>
        <li><strong>User ID:</strong> <code>{{ enriched_data.details.UserId }}</code></li>
        <li><strong>ARN:</strong> <code>{{ enriched_data.details.Arn }}</code></li>
        <li><strong>Created:</strong> <code>{{ enriched_data.details.CreateDate }}</code></li>
    </ul>

    {%- if enriched_data.attached_policies %}
    <p><strong>Attached Policies:</strong></p>
    <ul>
      {%- for policy in enriched_data.attached_policies %}
        <li>{{ policy.PolicyName }} <code>({{ policy.PolicyArn }})</code></li>
      {%- endfor %}
    </ul>
    {%- endif %}

    {%- if enriched_data.inline_policies %}
    <p><strong>Inline Policies:</strong></p>
    <ul>
      {%- for name, doc in enriched_data.inline_policies.items() %}
        <li>{{ name }}</li>
      {%- endfor %}
    </ul>
    {%- endif %}

    {%- if enriched_data.permission_analysis and enriched_data.permission_analysis.risks_found %}
    <h3>ðŸš¨ Policy Analysis</h3>
    <p>The following risks were identified in the principal's IAM policies:</p>
    <ul>
      {%- for policy_name, risks in enriched_data.permission_analysis.risks_found.items() %}
        <li><strong>{{ policy_name }}</strong>:
          <ul>
          {%- for risk in risks %}
            <li><code>{{ risk | safe }}</code></li>
          {%- endfor %}
          </ul>
        </li>
      {%- endfor %}
    </ul>
    {%- endif %}

    {%- if enriched_data.cloudtrail_history %}
    <h3>ðŸ“œ Recent CloudTrail Events</h3>
    <p>A summary of the most recent API calls made by this principal:</p>
    <ul>
      {%- for event in enriched_data.cloudtrail_history %}
        <li><strong>{{ event.EventTime }}</strong> | <code>{{ event.EventName }}</code> (Source: {{ event.EventSource }})</li>
      {%- endfor %}
    </ul>
    {%- endif %}

{% else %}
    <p><em>Detailed user information was not available for this finding.</em></p>
{% endif %}